!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self)["rx-util"]=t()}(this,function(){"use strict";function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"unknown",n=document.createElement("a");n.download=t,n.style.display="none",n.href=URL.createObjectURL(e),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function c(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function a(u){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=u.apply(e,a);function o(e){c(r,t,n,o,i,"next",e)}function i(e){c(r,t,n,o,i,"throw",e)}o(void 0)})}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function t(){return(t=a(regeneratorRuntime.mark(function e(t){var n,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=1<r.length&&void 0!==r[1]?r[1]:"unknown.txt",i(new Blob(i,{type:"text/plain"}),n);case 3:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function n(){return(n=a(regeneratorRuntime.mark(function e(t){var n,r,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<o.length&&void 0!==o[1]?o[1]:t.substr(t.lastIndexOf("/")),e.prev=1,e.next=4,fetch(t);case 4:return r=e.sent,e.next=7,r.blob();case 7:i(e.sent,n),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",console.log("下载出错了 ",e.t0));case 14:case"end":return e.stop()}},e,this,[[1,11]])}))).apply(this,arguments)}function r(){return(r=a(regeneratorRuntime.mark(function e(t,n){var r,o,i,a=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=2<a.length&&void 0!==a[2]?a[2]:{},e.next=3,fetch(t,r);case 3:return o=e.sent,e.next=6,o.blob();case 6:i=e.sent,n.src=window.URL.createObjectURL(i);case 8:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var s=function(e){var t={href:"",website:"",protocal:"",domain:"",accessPath:"",params:{}};return Object.assign(t,e),t};var e,f=((e=function(r){var e=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).type,o=void 0===e?"readAsDataURL":e;return new Promise(function(t,n){r||n(new Error("file not exists"));var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=function(e){n(e)},e[o](r)})}).DataURL="readAsDataURL",e.Text="readAsText",e.BinaryString="readAsBinaryString",e.ArrayBuffer="readAsArrayBuffer",e);function l(e,t){var n=null,r=new Promise(function(e,t){n=function(){t(new Error("abort promise"))}}),o=Promise.race([e,r]);return setTimeout(function(){n()},t),o}function p(n){return new Promise(function(e){if("number"==typeof n)setTimeout(e,n);else if("function"==typeof n)var t=setInterval(function(){n()&&(clearInterval(t),e())},100);else e()})}var v,h=function(){function i(e){var t=e.timeout,n=void 0===t?1e4:t,r=e.limit,o=void 0===r?10:r;y(this,i),this.timeout=n,this.limit=o,this.execCount=0,this.waitArr=[]}var e,t,n,r;return e=i,(t=[{key:"_fetch",value:(r=a(regeneratorRuntime.mark(function e(t,n){var r,o=this,i=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){var e=a(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("执行 execCount: ".concat(o.execCount,", waitArr length: ").concat(o.waitArr.length,", index: ").concat(JSON.stringify(o.waitArr[0]))),o.execCount++,t=o.waitArr.shift(0),e.prev=3,e.next=6,l(fetch.apply(void 0,u(t)),o.timeout);case 6:return e.abrupt("return",e.sent);case 7:return e.prev=7,o.execCount--,e.finish(7);case 10:case"end":return e.stop()}},e,this,[[3,,7,10]])}));return function(){return e.apply(this,arguments)}}(),this.waitArr.push(i),e.next=4,p(function(){return o.execCount<o.limit});case 4:return e.abrupt("return",r());case 5:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})}])&&o(e.prototype,t),n&&o(e,n),i}();function d(){return(d=a(regeneratorRuntime.mark(function e(t,n){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=[],e.t0=regeneratorRuntime.keys(t);case 2:if((e.t1=e.t0()).done){e.next=14;break}return o=e.t1.value,e.t2=r.push,e.t3=r,e.t4=u,e.next=9,n(t[o]);case 9:e.t5=e.sent,e.t6=(0,e.t4)(e.t5),e.t2.apply.call(e.t2,e.t3,e.t6),e.next=2;break;case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function w(e,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(e){return e};return e.reduce(function(e,t){return e.hasOwnProperty(n(t))||(e[n(t)]=r(t)),e},{})}function x(e,t){for(var n="",r=0;r<t;r++)n+=e;return n}function m(e){return e.selectionStart}function g(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t;e.focus(),e.setSelectionRange(t,n)}function b(e){return e&&"string"==typeof e?e.toLowerCase():e}return{download:i,downloadString:function(e){return t.apply(this,arguments)},downloadUrl:function(e){return n.apply(this,arguments)},getCookies:function(){return document.cookie.split(";").map(function(e){return e.split("=")}).map(function(e){return e[0]=e[0].trim(),e[1]=e[1].trim(),e}).filter(function(e){return e[0]&&e[1]}).reduce(function(e,t){return e[t[0]]=t[1],e},{})},loadResource:function(e,t){return r.apply(this,arguments)},parseUrl:function(e){if(!e)throw new Error("url 不能为空");var t=new RegExp("^(\\w+)://([\\w\\.]*)").exec(e),n=s({href:e,website:t[0],protocal:t[1],domain:t[2]}),r=e.substr(n.website.length),o=r.indexOf("?");return-1===o?n.accessPath=r:(n.accessPath=r.substr(0,o),n.params=r.substr(o+1).split("&").map(function(e){return e.split("=")}).filter(function(e){return""!==e[0]}).reduce(function(e,t){var n=decodeURIComponent(t[0]),r=decodeURIComponent(1===t.length?"":t[1]),o=e[n];return void 0!==o?(Array.isArray(o)||(e[n]=[o]),e[n].push(r)):e[n]=r,e},{})),n},readLocal:f,spliceParams:function(e){if(!e)throw new Error("参数对象不能为空：".concat(e));var t="";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t+="".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(r),"&")}return t},fetchTimeout:l,FetchLimiting:h,asIterator:function(e){for(var t=[];;){var n=e.next();if(n.done)break;t.push(n.value)}return t},asyncFlatMap:function(e,t){return d.apply(this,arguments)},flatMap:function(e,n){return e.reduce(function(e,t){return e.concat(n(t))},[])},groupBy:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return JSON.stringify(e)},r={};return e.forEach(function(e){var t=n(e);(r[t]||(r[t]=[])).push(e)}),Object.keys(r).map(function(e){return r[e]})},range:function(e,t){for(var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=[],o=e;o<t;o+=n)r.push(o);return r},toObject:w,uniqueBy:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return JSON.stringify(e)},n={};return e.filter(function(e){return!n.hasOwnProperty(t(e))&&(n[t(e)]=!0)})},dateFormat:function(e,t){var n={"y+":e.getFullYear(),"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),"S+":e.getMilliseconds()};for(var r in n)if(new RegExp("("+r+")").test(t))if("y+"===r)t=t.replace(RegExp.$1,(""+n[r]).substr(4-RegExp.$1.length));else if("S+"===r){var o=RegExp.$1.length;o=1===o?3:o,t=t.replace(RegExp.$1,("00"+n[r]).substr((""+n[r]).length-1,o))}else t=t.replace(RegExp.$1,1===RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length));return t},strToDate:function(n,e){var t=new Date,r=function e(t,n,r,o){y(this,e),this.name=t,this.format=n,this.value=r,this.index=o},o={year:"y{2}|y{4}",month:"M{1,2}",day:"d{1,2}",hour:"h{1,2}",minute:"m{1,2}",second:"s{1,2}",milliSecond:"S{1,3}"},i={year:t.getFullYear().toString(),month:"01",day:"01",hour:"00",minute:"00",second:"00",milliSecond:"000"},a=[];for(var u in o){var c=new RegExp(o[u]);if(c.test(e)){var s=c.exec(e)[0],f=x("`",s.length),l=e.indexOf(s);e=e.replace(s,f),a.push(new r(u,x("\\d",s.length),null,l))}else a.push(new r(u,null,i[u],-1))}if(e=e.replace(new RegExp("`","g"),"\\d"),!new RegExp(e).test(n))return null;a.sort(function(e,t){return e.index-t.index}).map(function(e){var t=new RegExp(e).exec(n);return null!==t&&0<t.length&&(n=n.replace(t[0],""),e.value=t[0]),e});for(var p=0,v=a.length;p<v;p++){var h=a[p].format;if(null!=h){var d=new RegExp(h).exec(n);null!==d&&0<d.length&&(n=n.replace(d[0],""),a[p].value=d[0])}}var m=w(a,function(e){return e.name},function(e){return e.value});2===m.year.length&&(m.year=t.getFullYear().toString().substr(0,2).concat(m.year));var g="".concat(m.year,"-").concat(m.month,"-").concat(m.day,"T").concat(m.hour,":").concat(m.minute,":").concat(m.second,".").concat(m.milliSecond,"Z");try{return new Date(g)}catch(e){return null}},createElByString:function(e){var t=document.createElement("div");return t.innerHTML=e,t.querySelector("*")},getCusorPostion:m,insertText:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:m(e),r=e.value;e.value=r.substr(0,n)+t+r.substr(n),g(e,n+t.length)},isEditable:function(e){return e&&(e.isContentEditable||["input","date","datetime","select","textarea"].includes(b(e.tagName)))},lastFocus:(v=null,document.addEventListener("focus",function(e){v=e.target},!0),document.addEventListener("blur",function(e){v=null},!0),function(){return v}),removeEl:function(e){e.parentElement.removeChild(e)},removeText:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e.selectionStart,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e.selectionEnd,r=m(e),o=e.value;e.value=o.substr(0,t)+o.substr(n,o.length),g(e,r)},setCusorPostion:g,watchEventListener:function(){var o=document.addEventListener,i=EventTarget.prototype.addEventListener,a=document.removeEventListener,u=EventTarget.prototype.removeEventListener,c=[],s=function e(t,n,r,o){y(this,e),this.el=t,this.type=n,this.listener=r,this.useCapture=o};function e(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=this===document?o:i;c.push(new s(this,e,t,n)),r.apply(this,arguments)}function t(e){var n=arguments,r=this,o=r===document?a:u,t=c.map(function(e,t){return e.el===r||e.type===n[0]?t:-1}).filter(function(e){return-1!==e});t.forEach(function(e){var t=c[e];o.apply(t.el,[t.type,t.listener,t.useCapture])}),t.sort(function(e,t){return t-e}).forEach(function(e){return c.splice(e,1)})}document.addEventListener=EventTarget.prototype.addEventListener=e,document.removeEventListenerByType=EventTarget.prototype.removeEventListenerByType=t},appends:function(e){for(var t in e)this.append(t,e[t]);return this},deletes:function(t,e){return e.forEach(function(e){return t.delete(e)}),t},sets:function(e){for(var t in e)this.set(t,e[t]);return this},toArray:function(e){return Array.asIterator(e.keys())},debounce:function(n,r){var o;return function(){var e=this,t=arguments;o&&clearTimeout(o),o=setTimeout(function(){r.apply(e,t)},n)}},returnItself:function(e){return e},throttle:function(t,n){var r=0;return function(){var e=Date.now();t<e-r&&(n.apply(this,arguments),r=e)}},timing:function(e){var t=performance.now(),n=e();return n instanceof Promise?n.then(function(){return performance.now()-t}):performance.now()-t},wait:p,waitResource:function(r,e){var o=Object.assign({interval:1e3,max:10},e),i=0;return new Promise(function(e,t){var n=setInterval(function(){r()&&(clearInterval(n),e()),++i>=o.max&&(clearInterval(n),t(new Error("等待超时")))},o.interval)})},fill:x,format:function(e,n){return n?Object.keys(n).reduce(function(e,t){return e.replace(new RegExp("{".concat(t,"}"),"g"),n[t])},e):e},toLowerCase:b,toUpperCase:function(e){return e&&"string"==typeof e?e.toUpperCase():e}}});
